@page "/login"
@using System.Net.Http
@inject NavigationManager Navigation
   
@if(showMessage)
{
    <p>@errorMessage</p>
}

<div class="form-wrapper">
    <div class="form-container">LOGIN</div>
    <EditForm model="user" method="post" FormName="CreateForm" OnValidSubmit="() => HandleSubmitAsync()" Enhance>
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="text-field">
            <label for="email">E-mail:</label>
            <InputText id="email" @bind-Value="user.Email" class="input" />
            <ValidationMessage For="@(() => user.Email)" />
        </div>

        <div class="text-field">
            <label for="password">Password:</label>
            <InputText id="password" type="password" @bind-Value="user.Password" class="input" />
            <ValidationMessage For="@(() => user.Password)" />
        </div>

        @if (showMessage)
        {
            <p class="error">@errorMessage</p>
        }

        <button type="submit" class="submit-button">LOGIN</button>

        <p class="to-register">
            Don't have an account? <a href="/register">Register now</a>
        </p>
    </EditForm>
</div>


@code {
    UserLoginDto user = new UserLoginDto();
    string errorMessage = "Incorrect login or password. Please try again";
    bool showMessage = false;    

    private async Task HandleSubmitAsync()
    {
        showMessage = false;

        bool success = await ApiService.Login(user);

        if (success)
        {
            StateHasChanged();
            Navigation.NavigateTo("/");
        }
        else
        {
            showMessage = true;
        }
    }
}
